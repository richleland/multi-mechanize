<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <title>Multi-Mechanize Performance Test Results</title>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
    <script src="../static/js/highcharts/highcharts.js" type="text/javascript"></script>
    <script src="../static/js/bootstrap-dropdown.js" type="text/javascript"></script>
    <!--<script src="../static/js/multi-mechanize.js" type="text/javascript"></script>-->
    <script type="text/javascript" charset="utf-8">
      var responseTimeLineGraph;
      var responseTimeScatterGraph;
      var throughputGraph;

      var responseTimeLineGraphOptions = {
        chart: {
          renderTo: 'responseTimeLineGraph',
          defaultSeriesType: 'line',
          animation: false,
          borderColor: '#E5E5E5',
          borderWidth: 1
        },
        legend: {
          align: 'right',
          backgroundColor: '#FFF',
          verticalAlign: 'top',
          x: -10,
          y: 10,
          floating: true,
          layout: 'vertical'
        },
        title: {
          text: 'Response Time: {{ ts_interval }} sec time-series'
        },
        xAxis: {
          title: {
            text: 'Elapsed Time (secs)'
          },
          gridLineWidth: 1,
          gridLineDashStyle: 'dot'
        },
        yAxis: {
          title: {
            text: 'Response Time (secs)'
          },
          min: 0
        },
        plotOptions: {
          line: {
            pointStart: 0,
            pointInterval: {{ ts_interval }}
          }
        },
        series: [
          {
            name: '90%'
          },
          {
            name: '80%'
          },
          {
            name: 'avg'
          }
        ]
      };

      var responseTimeScatterGraphOptions = {
        chart: {
          renderTo: 'responseTimeScatterGraph',
          defaultSeriesType: 'scatter',
          animation: false,
          borderColor: '#E5E5E5',
          borderWidth: 1
        },
        legend: {
          enabled: false
        },
        title: {
          text: 'Response Time: raw data (all points)'
        },
        xAxis: {
          title: {
            text: 'Elapsed Time (secs)'
          },
          gridLineWidth: 1,
          gridLineDashStyle: 'dot'
        },
        yAxis: {
          title: {
            text: 'Response Time (secs)'
          },
          min: 0
        },
        series: [
          {
            name: 'response time'
          }
        ]
      };

      var throuputGraphOptions = {
        chart: {
          renderTo: 'throughputGraph',
          defaultSeriesType: 'line',
          animation: false,
          borderColor: '#E5E5E5',
          borderWidth: 1
        },
        legend: {
          enabled: false
        },
        title: {
          text: 'Throughput: 5 sec time-series'
        },
        xAxis: {
          title: {
            text: 'Elapsed Time (secs)'
          },
          gridLineWidth: 1,
          gridLineDashStyle: 'dot'
        },
        yAxis: {
          title: {
            text: 'Transactions Per Second (count)'
          },
          min: 0
        },
        plotOptions: {
          line: {
            pointStart: 0,
            pointInterval: {{ ts_interval }}
          }
        },
        series: [
          {
            name: 'transactions'
          }
        ]
      };

      $(function(){
        // twitter bootstrap dropdown
        $('.dropdown-toggle').dropdown();

        // render the response time line graph
        responseTimeLineGraphOptions.series[0].data = [0, {% for interval in intervals %}{{ interval.pct_90 }}{% if not loop.last %}, {% endif %}{% endfor %}]
        responseTimeLineGraphOptions.series[1].data = [0, {% for interval in intervals %}{{ interval.pct_80 }}{% if not loop.last %}, {% endif %}{% endfor %}]
        responseTimeLineGraphOptions.series[2].data = [0, {% for interval in intervals %}{{ interval.avg }}{% if not loop.last %}, {% endif %}{% endfor %}]
        responseTimeLineGraph = new Highcharts.Chart(responseTimeLineGraphOptions)

        // render the response time scatter graph
        responseTimeScatterGraphOptions.series[0].data = [[0, 0], {% for elapsed, value in trans_timer_points %}[{{ elapsed }}, {{ value }}]{% if not loop.last %}, {% endif %}{% endfor %}]
        responseTimeScatterGraph = new Highcharts.Chart(responseTimeScatterGraphOptions)

        // render the throughput graph
        throuputGraphOptions.series[0].data = [0, {% for interval, point in throughput_points.items() %}{{ point }}{% if not loop.last %}, {% endif %}{% endfor %}]
        throughputGraph = new Highcharts.Chart(throuputGraphOptions)
      });
    </script>
    <link rel="stylesheet" href="../static/css/bootstrap.min.css" type="text/css">
    <link rel="stylesheet" href="../static/css/multi-mechanize.css" type="text/css">
  </head>
  <body>
    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="brand" href="#">Multi-Mechanize</a>
          <ul class="nav">
            <li><a href="#">Summary</a></li>
            <li><a href="#">All transactions</a></li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">Custom timers<b class="caret"></b></a>
              <ul class="dropdown-menu">
                <li><a href="#">Home page</a></li>
                <li><a href="#">Random page</a></li>
              </ul>
            </li>
          </ul>
        </div>
      </div>
    </div>

    <div class="container">
      <h1>Multi-Mechanize Performance Test Results</h1>

      <section id="summary">
        <div class="page-header">
          <h2>Summary</h2>
        </div>
        <table class="table table-striped table-bordered table-condensed">
          <tbody>
            <tr>
              <th>transactions</th>
              <td>{{ total_transactions }}</td>
            </tr>
            <tr>
              <th>errors</th>
              <td>{{ total_errors }}</td>
            </tr>
            <tr>
              <th>run time</th>
              <td>{{ run_time }} secs</td>
            </tr>
            <tr>
              <th>rampup time</th>
              <td>{{ rampup }} secs</td>
            </tr>
            <tr>
              <th>start time</th>
              <td>{{ start_datetime }}</td>
            </tr>
            <tr>
              <th>end time</th>
              <td>{{ finish_datetime }}</td>
            </tr>
            <tr>
              <th>time-series interval</th>
              <td>{{ ts_interval }} secs</td>
            </tr>
          </tbody>
        </table>

        {% if user_group_configs %}
        <h3>Workload configuration</h3>
        <table class="table table-striped table-bordered table-condensed">
          <thead>
            <tr>
              <th>group name</th>
              <th>threads</th>
              <th>script name</th>
            </tr>
          </thead>
          <tbody>
            {% for config in user_group_configs %}
            <tr>
              <td>{{ config.name }}</td>
              <td>{{ config.num_threads }}</td>
              <td>{{ config.script_file }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
        {% endif %}
      </section>

      <section id="all-transactions">
        <div class="page-header">
          <h2>All transactions</h2>
        </div>
        <h3>Transaction response summary (secs)</h3>
        <table class="table table-striped table-bordered table-condensed">
          <thead>
            <tr>
              <th>count</th>
              <th>min</th>
              <th>avg</th>
              <th>80%</th>
              <th>90%</th>
              <th>95%</th>
              <th>max</th>
              <th>stdev</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>{{ transaction_summary.count }}</td>
              <td>{{ transaction_summary.min }}</td>
              <td>{{ transaction_summary.avg }}</td>
              <td>{{ transaction_summary.pct_80 }}</td>
              <td>{{ transaction_summary.pct_90 }}</td>
              <td>{{ transaction_summary.pct_95 }}</td>
              <td>{{ transaction_summary.max }}</td>
              <td>{{ transaction_summary.stdev }}</td>
            </tr>
          </tbody>
        </table>

        <h3>Interval details (secs)</h3>
        <table class="table table-striped table-bordered table-condensed">
          <thead>
            <tr>
              <th>interval</th>
              <th>count</th>
              <th>rate</th>
              <th>min</th>
              <th>avg</th>
              <th>80%</th>
              <th>90%</th>
              <th>95%</th>
              <th>max</th>
              <th>stdev</th>
            </tr>
          </thead>
          <tbody>
            {% for interval in intervals %}
            <tr>
              <td>{{ interval.num }}</td>
              <td>{{ interval.count }}</td>
              <td>{{ interval.rate }}</td>
              <td>{{ interval.min }}</td>
              <td>{{ interval.avg }}</td>
              <td>{{ interval.pct_80 }}</td>
              <td>{{ interval.pct_90 }}</td>
              <td>{{ interval.pct_95 }}</td>
              <td>{{ interval.max }}</td>
              <td>{{ interval.stdev }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </section>

      <h3>Graphs</h3>
      <div id="responseTimeLineGraph" class="graph"></div>
      <div id="responseTimeScatterGraph" class="graph"></div>
      <div id="throughputGraph" class="graph"></div>

      <footer class="footer">
        <p>Results generated using <b>Multi-Mechanize</b></p>
        <p><a href="http://testutils.org/multi-mechanize">Documentation</a>, <a href="http://github.com/cgoldberg/multi-mechanize">Code</a>, <a href="http://pypi.python.org/pypi/multi-mechanize">PyPI</a></p>
      </footer>
    </div>

  </body>
</html>
